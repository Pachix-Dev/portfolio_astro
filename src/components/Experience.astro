---
import { getCollection, render } from 'astro:content'
import { getMessages, normalizeLocale } from '../i18n/ui'

const locale = normalizeLocale(Astro.props.locale ?? Astro.currentLocale)
const t = getMessages(locale)

const experiences = await getCollection('experience', (entry) =>
  entry.id.startsWith(`${locale}/`),
)

// Ordena por fecha descendente
const sortedExperiences = experiences.sort((a, b) => {
  const yearA = parseInt(a.data.startDate)
  const yearB = parseInt(b.data.startDate)
  return yearB - yearA
})
---

<section class='mt-20 py-12 max-w-6xl mx-auto px-5' aria-label='Experience'>
  <h2 class='text-4xl font-bold mb-12'>{t.experience}</h2>
  <ol class='relative border-s border-gray-700'>
    {
      sortedExperiences.map(async (exp) => {
        const { Content } = await render(exp)
        return (
          <li class='mb-10 ms-6'>
            <span class='absolute flex items-center justify-center w-6 h-6 bg-violet-600 rounded-full -start-3 ring-8 ring-gray-900'>
              <svg
                xmlns='http://www.w3.org/2000/svg'
                fill='none'
                viewBox='0 0 24 24'
                stroke-width='1.5'
                stroke='currentColor'
                class='size-4'
              >
                <path
                  stroke-linecap='round'
                  stroke-linejoin='round'
                  d='M6.75 2.994v2.25m10.5-2.25v2.25m-14.252 13.5V7.491a2.25 2.25 0 0 1 2.25-2.25h13.5a2.25 2.25 0 0 1 2.25 2.25v11.251m-18 0a2.25 2.25 0 0 0 2.25 2.25h13.5a2.25 2.25 0 0 0 2.25-2.25m-18 0v-7.5a2.25 2.25 0 0 1 2.25-2.25h13.5a2.25 2.25 0 0 1 2.25 2.25v7.5m-6.75-6h2.25m-9 2.25h4.5m.002-2.25h.005v.006H12v-.006Zm-.001 4.5h.006v.006h-.006v-.005Zm-2.25.001h.005v.006H9.75v-.006Zm-2.25 0h.005v.005h-.006v-.005Zm6.75-2.247h.005v.005h-.005v-.005Zm0 2.247h.006v.006h-.006v-.006Zm2.25-2.248h.006V15H16.5v-.005Z'
                />
              </svg>
            </span>

            <time class='bg-gray-800 border border-gray-700 text-gray-300 text-xs font-medium px-3 py-1 rounded inline-block mb-2'>
              {exp.data.startDate} - {exp.data.endDate}
            </time>

            <h3 class='text-xl font-bold text-white my-2'>{exp.data.title}</h3>

            <div class='flex flex-col gap-1 mb-4'>
              <p class='text-purple-400 font-semibold'>{exp.data.company}</p>
              <p class='text-gray-400 text-sm'>
                {exp.data.location} â€¢ {exp.data.type}
              </p>
            </div>

            <p class='text-gray-300 mb-4'>{exp.data.description}</p>

            <p class='mb-2'>{t.responsabilities}</p>
            {exp.data.responsabilities &&
              exp.data.responsabilities.length > 0 && (
                <ul class='list-disc list-inside text-gray-400 text-sm mb-4 space-y-1 ps-2'>
                  {exp.data.responsabilities.map((responsability) => (
                    <li>{responsability}</li>
                  ))}
                </ul>
              )}

            <p class='mb-2'>{t.achievements}</p>
            {exp.data.achievements && exp.data.achievements.length > 0 && (
              <ul class='list-disc list-inside text-gray-400 text-sm mb-4 space-y-1 ps-2'>
                {exp.data.achievements.map((achievement) => (
                  <li>{achievement}</li>
                ))}
              </ul>
            )}

            {exp.data.technologies && exp.data.technologies.length > 0 && (
              <div class='flex flex-wrap gap-2 mb-4'>
                {exp.data.technologies.map((tech) => (
                  <span class='bg-gray-800 text-gray-300 text-xs px-3 py-1 rounded border border-gray-700'>
                    {tech}
                  </span>
                ))}
              </div>
            )}

            <div class='prose prose-sm prose-invert max-w-none text-gray-300'>
              <Content />
            </div>
          </li>
        )
      })
    }
  </ol>
</section>
